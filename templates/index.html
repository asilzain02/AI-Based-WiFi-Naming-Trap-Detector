<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wi-Fi Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glow-card { transition: transform 0.3s, box-shadow 0.3s; }
        .glow-card:hover { transform: translateY(-5px); box-shadow: 0 0 25px rgba(0,255,0,0.5); }
        .rssi-bar { display: inline-block; width: 5px; height: 15px; margin-right: 1px; border-radius: 1px; transition: height 0.5s, background-color 0.5s; }
    </style>
</head>
<body class="bg-gray-900 text-black">

<!-- Header -->
<header class="bg-gradient-to-r from-indigo-800 to-purple-800 shadow p-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold flex items-center gap-2">üì∂ Wi-Fi Dashboard</h1>
    <button id="scan-btn" class="bg-yellow-500 text-black px-4 py-2 rounded hover:bg-yellow-400 transition transform hover:-translate-y-1 hover:scale-105">
        Scan Now
    </button>
</header>

<!-- Manual Input Form -->
<section class="container mx-auto mt-6 p-6 bg-gray-800 rounded shadow text-gray-100">
    <h2 class="text-xl font-bold mb-4">üîç Manual SSID + BSSID Prediction</h2>
    <form method="POST" class="grid md:grid-cols-3 gap-4">
        <input type="text" name="manual_ssid" placeholder="Enter SSID" required class="p-2 rounded text-black">
        <input type="text" name="manual_bssid" placeholder="Enter BSSID (e.g., 00:1A:2B:3C:4D:5E)" required class="p-2 rounded text-black">
        <button type="submit" class="bg-green-500 hover:bg-green-400 px-4 py-2 rounded font-semibold transition">Predict</button>
    </form>
</section>

<!-- Summary Metrics -->
<section class="container mx-auto mt-6 grid grid-cols-1 md:grid-cols-4 gap-4 text-gray-900">
    <div class="bg-gray-800 p-4 rounded shadow text-center text-gray-100">
        <p class="text-sm">Total Networks</p>
        <p id="total" class="text-2xl font-bold">0</p>
    </div>
    <div class="bg-green-600 p-4 rounded shadow text-center">
        <p class="text-sm">Real Networks</p>
        <p id="real" class="text-2xl font-bold">0</p>
    </div>
    <div class="bg-red-600 p-4 rounded shadow text-center">
        <p class="text-sm">Fake Networks</p>
        <p id="fake" class="text-2xl font-bold">0</p>
    </div>
    <div class="bg-indigo-700 p-4 rounded shadow text-center">
        <p class="text-sm">Strongest Network</p>
        <p id="strongest" class="text-xl font-semibold">N/A</p>
    </div>
</section>

<!-- Predictions Table -->
{% if predictions %}
<section class="container mx-auto mt-8 bg-gray-800 p-6 rounded text-gray-100">
    <h2 class="text-xl font-bold mb-4">üì° Prediction Results</h2>
    <table class="min-w-full border border-gray-700 rounded text-center">
        <thead class="bg-gray-700">
            <tr>
                <th class="px-4 py-2">SSID</th>
                <th class="px-4 py-2">BSSID</th>
                <th class="px-4 py-2">Prediction</th>
            </tr>
        </thead>
        <tbody>
            {% for (ssid, bssid), label in predictions %}
            <tr class="border-t border-gray-700">
                <td class="px-4 py-2">{{ ssid }}</td>
                <td class="px-4 py-2">{{ bssid }}</td>
                <td class="px-4 py-2 font-bold {{ 'text-green-400' if label=='real' else 'text-red-400' }}">{{ label|capitalize }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% endif %}

<!-- Network Cards (Auto Scan) -->
<main class="container mx-auto mt-6 grid md:grid-cols-2 lg:grid-cols-3 gap-6 text-white"  id="card-view"></main>

<!-- Footer -->
<footer class="mt-12 p-4 bg-gradient-to-r from-indigo-800 to-purple-800 text-center text-gray-100">
    &copy; 2025 Wi-Fi Dashboard | Built by Asil Zain & Rizwaan
</footer>

<script>
const scanBtn = document.getElementById('scan-btn');
const cardView = document.getElementById('card-view');
const totalEl = document.getElementById('total');
const realEl = document.getElementById('real');
const fakeEl = document.getElementById('fake');
const strongestEl = document.getElementById('strongest');

function getRssiBars(rssi) {
    const bars = [];
    for (let i=0;i<5;i++){
        let color = 'bg-gray-700';
        if (rssi > i*20) color = i<3 ? 'bg-green-500' : 'bg-yellow-500';
        bars.push(`<div class="rssi-bar ${color}"></div>`);
    }
    return bars.join('');
}

function renderNetworks(networks) {
    cardView.innerHTML = '';
    networks.forEach(n => {
        const card = document.createElement('div');
        card.className = `glow-card bg-gray-800 p-4 rounded shadow border-l-4 ${n.prediction_class==='real'?'border-green-500':'border-red-500'}`;
        card.innerHTML = `
            <h2 class="text-xl font-bold mb-2">${n.SSID || 'Unknown'}</h2>
            <p class="text-sm mb-1">BSSID: ${n.BSSID}</p>
            <p class="text-sm mb-1">Auth: ${n.Auth}</p>
            <p class="text-sm mb-1">Channel: ${n.Channel}</p>
            <p class="flex items-center mb-1 gap-1">RSSI: ${n.RSSI} <span class="flex">${getRssiBars(n.RSSI)}</span></p>
            <p class="font-bold ${n.prediction_class==='real'?'text-green-400':'text-red-400'}">${n.prediction}</p>
        `;
        cardView.appendChild(card);
    });
}

function updateSummary(summary){
    totalEl.textContent = summary.total;
    realEl.textContent = summary.real;
    fakeEl.textContent = summary.fake;
    strongestEl.textContent = summary.strongest.SSID || 'N/A';
}

async function fetchNetworks() {
    try {
        const res = await fetch('/api/scan');
        const data = await res.json();
        if (data && data.networks && data.networks.length > 0) {
            renderNetworks(data.networks);
            updateSummary(data.summary);
        } else {
            cardView.innerHTML = '<p class="text-gray-300 text-center col-span-full">‚ö†Ô∏è No networks found. Try again.</p>';
            updateSummary({ total: 0, real: 0, fake: 0, strongest: {} });
        }
    } catch(err){
        console.error(err);
    }
}

scanBtn.addEventListener('click', fetchNetworks);
setInterval(fetchNetworks, 10000);
</script>

</body>
</html>
